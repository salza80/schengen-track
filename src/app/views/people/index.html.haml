.row.mt-4
  .col-lg-9
    %h1.h3.mb-3
      %i.fa.fa-users.mr-2
      = t('common.manage_people')

    - if @people.count == 1
      .alert.alert-info
        %i.fa.fa-info-circle.mr-2
        = t('people.index.single_person_notice')

    .row.py-1.mb-3
      .col-auto
        = link_to my_details_path(locale: I18n.locale), class: "btn btn-outline-primary btn-md" do
          %i.fa.fa-user-cog.mr-2
          = t('common.manage_account')
      .col-auto.ml-auto
        = link_to new_person_path(locale: I18n.locale), class: "btn btn-add btn-md" do
          %i.fa.fa-plus.mr-2
          = t('common.add_person')

    - if @people.empty?
      .empty-state
        .empty-icon
          %i.fa.fa-users
        %h4= t('people.index.empty_state.title')
        %p= t('people.index.empty_state.description')
        = link_to new_person_path(locale: I18n.locale), class: "btn btn-add btn-lg" do
          %i.fa.fa-plus.mr-2
          = t('common.add_person')
    - else
      .responsive-table-container
        %table.table.table-striped.table-bordered.table-hover.responsive-table
          %caption= t('people.index.table.caption')
          %thead.bg-header
            %tr
              %th{scope: "col"}= t('people.index.table.columns.name')
              %th{scope: "col"}= t('people.index.table.columns.nationality')
              %th{scope: "col"}= t('people.index.table.columns.status')
              %th{scope: "col", class: 'modify-col'}= t('people.index.table.columns.actions')
          %tbody
            - @people.each do |person|
              %tr{class: (person == current_person ? 'table-active' : ''), data: {person_url: (set_current_person_path(person) unless person == current_person)}, style: (person == current_person ? '' : 'cursor: pointer;')}
                %th{scope: "row", class: 'bg-md-header'}
                  = person.full_name
                %td{"data-title": t('people.index.table.columns.nationality')}
                  = person.nationality&.localized_name || t('common.person_not_set')
                %td{"data-title": t('people.index.table.columns.status'), onclick: "event.stopPropagation();"}
                  - if person == current_person
                    %span.badge.badge-success.mr-2= t('people.index.table.badges.active')
                  - if person.is_primary
                    %span.badge.badge-info= t('people.index.table.badges.primary')
                  - else
                    = button_to make_primary_person_path(person, locale: I18n.locale), method: :post, class: "btn btn-sm btn-outline-primary", title: t('people.index.table.make_primary.title'), "aria-label": t('people.index.table.make_primary.aria', name: person.full_name), form: { class: "d-inline" } do
                      = t('people.index.table.make_primary.label')
                %td{"data-title": t('people.index.table.columns.actions'), onclick: "event.stopPropagation();"}
                  .action-buttons
                    = link_to edit_person_path(person, locale: I18n.locale), class: "btn btn-sm btn-icon", title: t('common.edit'), "aria-label": t('people.index.table.actions.edit_aria', name: person.full_name) do
                      %i.fa.fa-pencil-alt{"aria-hidden": "true"}
                    - unless person.is_primary
                      %a.btn.btn-sm.btn-icon.delete-person-link{href: "#", data: {delete_url: person_path(person, locale: I18n.locale), person_name: person.full_name, delete_message: t('people.index.delete_person_warning', person: person.full_name)}, title: t('common.delete'), "aria-label": t('people.index.table.actions.delete_aria', name: person.full_name)}
                        %i.fa.fa-trash{"aria-hidden": "true"}

    .row
      .col-lg-10.col-md-12
        .ad-block-limit.d-none.d-md-block
          %ins.adsbygoogle{"data-ad-client" => "ca-pub-8290979932488448", "data-ad-format" => "auto", "data-ad-slot" => "3629950616", :style => "display:block"}
  .col-lg-3.d-none.d-lg-block.mb-5{style: "padding-bottom: 220px;"}
    = render 'days/calendar_sidebar', show_legend: false

.row.d-lg-none.mt-2
  .col-12
    = render 'days/calendar_sidebar', sticky_sidebar: false, show_legend: false

-# Modal for delete confirmation
#deleteModal.modal.fade{"aria-hidden" => "true", "aria-labelledby" => "deleteModalLabel", role: "dialog", tabindex: "-1"}
  .modal-dialog{role: "document"}
    .modal-content
      .modal-header.delete-warning
        %h5#deleteModalLabel.modal-title
          %i.fa.fa-exclamation-triangle.mr-2{"aria-hidden" => "true"}
          = t('common.confirm_delete')
        %button.close.text-white{"aria-label" => "Close", "data-dismiss" => "modal", type: "button"}
          %span{"aria-hidden" => "true"} &times;
      .modal-body
        %p#deleteModalMessage= t('common.delete_warning')
      .modal-footer
        %button.btn.btn-secondary{"data-dismiss" => "modal", type: "button"}= t('common.cancel')
        %a#deleteConfirmButton.btn.btn-danger{href: "#"}
          %i.fa.fa-trash.mr-2{"aria-hidden" => "true"}
          = t('common.delete')

:javascript
  (adsbygoogle = window.adsbygoogle || []).push({});

:javascript
  document.addEventListener('DOMContentLoaded', function() {
    // Handle row clicks to switch person
    const rows = document.querySelectorAll('table tbody tr[data-person-url]');
    
    rows.forEach(function(row) {
      row.addEventListener('click', function(e) {
        const url = row.dataset.personUrl;
        if (url) {
          // Create and submit a form for POST request
          const form = document.createElement('form');
          form.method = 'POST';
          form.action = url;
          
          const csrfToken = document.querySelector('meta[name="csrf-token"]').content;
          const csrfInput = document.createElement('input');
          csrfInput.type = 'hidden';
          csrfInput.name = 'authenticity_token';
          csrfInput.value = csrfToken;
          form.appendChild(csrfInput);
          
          document.body.appendChild(form);
          form.submit();
        }
      });
    });
    
    // Handle delete button clicks
    const deleteButtons = document.querySelectorAll('.delete-person-link');
    const $modal = $('#deleteModal');
    const $confirmButton = $('#deleteConfirmButton');
    
    deleteButtons.forEach(function(button) {
      button.addEventListener('click', function(e) {
        e.preventDefault();
        e.stopPropagation();
        
        const deleteUrl = button.dataset.deleteUrl;
        const deleteMessage = button.dataset.deleteMessage;
        
        // Update modal message with localized text
        $('#deleteModalMessage').text(deleteMessage);
        
        // Show the modal
        $modal.modal('show');
        
        // Handle delete confirmation click
        $confirmButton.off('click').on('click', function(e) {
          e.preventDefault();
          
          // Create a form to submit the DELETE request
          const form = document.createElement('form');
          form.method = 'POST';
          form.action = deleteUrl;
          
          const csrfToken = document.querySelector('meta[name="csrf-token"]').content;
          const csrfInput = document.createElement('input');
          csrfInput.type = 'hidden';
          csrfInput.name = 'authenticity_token';
          csrfInput.value = csrfToken;
          form.appendChild(csrfInput);
          
          const methodInput = document.createElement('input');
          methodInput.type = 'hidden';
          methodInput.name = '_method';
          methodInput.value = 'delete';
          form.appendChild(methodInput);
          
          document.body.appendChild(form);
          form.submit();
        });
      });
    });
  });
