.card
  .card-body
    %h3{ class: "card-title"}
      = t('common.edit_my_details')
    = render 'form'
  .card-footer
    = link_to t('common.back'), visits_path(locale: I18n.locale)
    - unless @user.is_guest?
      %a#deleteAccountButton.btn.btn-link.text-danger.float-right.p-0{href: "#", data: {delete_url: delete_account_path}}
        = t('my_details_page.delete_account')

-# Modal for delete confirmation
#deleteModal.modal.fade{"aria-hidden" => "true", "aria-labelledby" => "deleteModalLabel", role: "dialog", tabindex: "-1"}
  .modal-dialog{role: "document"}
    .modal-content
      .modal-header.delete-warning
        %h5#deleteModalLabel.modal-title
          %i.fa.fa-exclamation-triangle.mr-2{"aria-hidden" => "true"}
          = t('common.confirm_delete')
        %button.close.text-white{"aria-label" => "Close", "data-dismiss" => "modal", type: "button"}
          %span{"aria-hidden" => "true"} &times;
      .modal-body
        %p#deleteModalMessage= t('my_details_page.delete_account_confirm')
      .modal-footer
        %button.btn.btn-secondary{"data-dismiss" => "modal", type: "button"}= t('common.cancel')
        %a#deleteConfirmButton.btn.btn-danger{href: "#"}
          %i.fa.fa-trash.mr-2{"aria-hidden" => "true"}
          = t('common.delete')

:javascript
  document.addEventListener('DOMContentLoaded', function() {
    const deleteButton = document.getElementById('deleteAccountButton');
    if (deleteButton) {
      const $modal = $('#deleteModal');
      const $confirmButton = $('#deleteConfirmButton');
      
      deleteButton.addEventListener('click', function(e) {
        e.preventDefault();
        
        const deleteUrl = deleteButton.dataset.deleteUrl;
        
        // Show the modal
        $modal.modal('show');
        
        // Handle delete confirmation click
        $confirmButton.off('click').on('click', function(e) {
          e.preventDefault();
          
          // Create a form to submit the DELETE request
          const form = document.createElement('form');
          form.method = 'POST';
          form.action = deleteUrl;
          
          const csrfToken = document.querySelector('meta[name="csrf-token"]').content;
          const csrfInput = document.createElement('input');
          csrfInput.type = 'hidden';
          csrfInput.name = 'authenticity_token';
          csrfInput.value = csrfToken;
          form.appendChild(csrfInput);
          
          const methodInput = document.createElement('input');
          methodInput.type = 'hidden';
          methodInput.name = '_method';
          methodInput.value = 'delete';
          form.appendChild(methodInput);
          
          document.body.appendChild(form);
          form.submit();
        });
      });
    }
  });
