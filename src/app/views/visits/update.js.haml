- if @visit.errors.any?
  :plain
    // Visit update failed - show errors in modal
    $('#visitModal .modal-body').html('#{j render("form")}');
    
    // Re-initialize cascade dropdowns after form is reloaded
    const country = #{@country_options.html_safe};
    const CountriesList = new App.Cascade($('#Continent'), $('#visit_country_id'), country, 'id', 'name', 'continent_id');
- else
  :plain
    // Visit was successfully updated
    $('#visitModal').modal('hide');
    
    // Show success message
    const message = '<div class="alert alert-success alert-dismissible fade show" role="alert">Visit was successfully updated.<button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button></div>';
    $('body').prepend(message);
    
    // Get the saved visit's entry date (Rails already parsed the form submission)
    const dateString = '#{@visit.entry_date.to_s}'; // Already in YYYY-MM-DD format
    
    // Store for highlighting after reload
    sessionStorage.setItem('updatedVisitDate', dateString);
    
    // Store scroll position to preserve after reload
    sessionStorage.setItem('scrollPosition', window.pageYOffset.toString());
    
    // Reload page to refresh calendar
    setTimeout(function() {
      location.reload();
    }, 300);
