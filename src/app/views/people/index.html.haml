.row.mt-4
  .col-lg-9
    %h1.h3.mb-3
      %i.fa.fa-users.mr-2
      Manage People

    - if @people.count == 1
      .alert.alert-info
        %i.fa.fa-info-circle.mr-2
        You currently have one person. Add more to track travel plans for multiple people or scenarios.

    .row.py-1.mb-3
      .col-auto
        = link_to my_details_path(locale: I18n.locale), class: "btn btn-outline-primary btn-md" do
          %i.fa.fa-user-cog.mr-2
          = t('common.manage_account')
      .col-auto.ml-auto
        = link_to new_person_path(locale: I18n.locale), class: "btn btn-add btn-md" do
          %i.fa.fa-plus.mr-2
          Add new person

    - if @people.empty?
      .empty-state
        .empty-icon
          %i.fa.fa-users
        %h4 No people found
        %p Add your first person to start tracking travel plans
        = link_to new_person_path(locale: I18n.locale), class: "btn btn-add btn-lg" do
          %i.fa.fa-plus.mr-2
          Add new person
    - else
      .responsive-table-container
        %table.table.table-striped.table-bordered.table-hover.responsive-table
          %caption People you are tracking travel plans for
          %thead.bg-header
            %tr
              %th{scope: "col"} Name
              %th{scope: "col"} Nationality
              %th{scope: "col"} Status
              %th{scope: "col", class: 'modify-col'} Actions
          %tbody
            - @people.each do |person|
              %tr{class: (person == current_person ? 'table-active' : ''), data: {person_url: (set_current_person_path(person) unless person == current_person)}, style: (person == current_person ? '' : 'cursor: pointer;')}
                %th{scope: "row", class: 'bg-md-header'}
                  = person.full_name
                %td{"data-title": "Nationality"}
                  = person.nationality&.name || 'Not set'
                %td{"data-title": "Status", onclick: "event.stopPropagation();"}
                  - if person == current_person
                    %span.badge.badge-success.mr-2 Active
                  - if person.is_primary
                    %span.badge.badge-info Primary
                  - else
                    = button_to make_primary_person_path(person, locale: I18n.locale), method: :post, class: "btn btn-sm btn-outline-primary", title: "Make primary", "aria-label": "Make #{person.full_name} primary", form: { style: "display: inline;" } do
                      Make primary
                %td{"data-title": "Actions", onclick: "event.stopPropagation();"}
                  .action-buttons
                    = link_to edit_person_path(person, locale: I18n.locale), class: "btn btn-sm btn-icon", title: "Edit", "aria-label": "Edit #{person.full_name}" do
                      %i.fa.fa-pencil-alt{"aria-hidden": "true"}
                    - unless person.is_primary
                      %a.btn.btn-sm.btn-icon.delete-person-link{href: "#", data: {delete_url: person_path(person, locale: I18n.locale), person_name: person.full_name}, title: "Delete", "aria-label": "Delete #{person.full_name}"}
                        %i.fa.fa-trash{"aria-hidden": "true"}

    .row
      .col-lg-10.col-md-12
        .ad-block-limit.d-none.d-md-block
          %ins.adsbygoogle{"data-ad-client" => "ca-pub-8290979932488448", "data-ad-format" => "auto", "data-ad-slot" => "3629950616", :style => "display:block"}
  .col-lg-3.d-none.d-lg-block.mb-5{style: "padding-bottom: 220px;"}
    = render 'days/calendar_sidebar', show_legend: false

.row.d-lg-none.mt-2
  .col-12
    = render 'days/calendar_sidebar', sticky_sidebar: false, show_legend: false

-# Modal for delete confirmation
#deleteModal.modal.fade{"aria-hidden" => "true", "aria-labelledby" => "deleteModalLabel", role: "dialog", tabindex: "-1"}
  .modal-dialog{role: "document"}
    .modal-content
      .modal-header.delete-warning
        %h5#deleteModalLabel.modal-title
          %i.fa.fa-exclamation-triangle.mr-2{"aria-hidden" => "true"}
          = t('common.confirm_delete')
        %button.close.text-white{"aria-label" => "Close", "data-dismiss" => "modal", type: "button"}
          %span{"aria-hidden" => "true"} &times;
      .modal-body
        %p#deleteModalMessage= t('common.delete_warning')
      .modal-footer
        %button.btn.btn-secondary{"data-dismiss" => "modal", type: "button"}= t('common.cancel')
        %a#deleteConfirmButton.btn.btn-danger{href: "#"}
          %i.fa.fa-trash.mr-2{"aria-hidden" => "true"}
          = t('common.delete')

:javascript
  (adsbygoogle = window.adsbygoogle || []).push({});

:javascript
  document.addEventListener('DOMContentLoaded', function() {
    // Handle row clicks to switch person
    const rows = document.querySelectorAll('table tbody tr[data-person-url]');
    
    rows.forEach(function(row) {
      row.addEventListener('click', function(e) {
        const url = row.dataset.personUrl;
        if (url) {
          // Create and submit a form for POST request
          const form = document.createElement('form');
          form.method = 'POST';
          form.action = url;
          
          const csrfToken = document.querySelector('meta[name="csrf-token"]').content;
          const csrfInput = document.createElement('input');
          csrfInput.type = 'hidden';
          csrfInput.name = 'authenticity_token';
          csrfInput.value = csrfToken;
          form.appendChild(csrfInput);
          
          document.body.appendChild(form);
          form.submit();
        }
      });
    });
    
    // Handle delete button clicks
    const deleteButtons = document.querySelectorAll('.delete-person-link');
    const $modal = $('#deleteModal');
    const $confirmButton = $('#deleteConfirmButton');
    
    deleteButtons.forEach(function(button) {
      button.addEventListener('click', function(e) {
        e.preventDefault();
        e.stopPropagation();
        
        const deleteUrl = button.dataset.deleteUrl;
        const personName = button.dataset.personName;
        
        // Update modal message with person name
        $('#deleteModalMessage').text('Are you sure you want to delete ' + personName + '? This action cannot be undone.');
        
        // Show the modal
        $modal.modal('show');
        
        // Handle delete confirmation click
        $confirmButton.off('click').on('click', function(e) {
          e.preventDefault();
          
          // Create a form to submit the DELETE request
          const form = document.createElement('form');
          form.method = 'POST';
          form.action = deleteUrl;
          
          const csrfToken = document.querySelector('meta[name="csrf-token"]').content;
          const csrfInput = document.createElement('input');
          csrfInput.type = 'hidden';
          csrfInput.name = 'authenticity_token';
          csrfInput.value = csrfToken;
          form.appendChild(csrfInput);
          
          const methodInput = document.createElement('input');
          methodInput.type = 'hidden';
          methodInput.name = '_method';
          methodInput.value = 'delete';
          form.appendChild(methodInput);
          
          document.body.appendChild(form);
          form.submit();
        });
      });
    });
  });
